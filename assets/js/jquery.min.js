var canvas = $('#logo'); //canvas initialize
var context = canvas.get(0).getContext('2d'); //context canvas initialize
var secret = document.getElementById('logo');


var speedIn = 5; //expand speed
var speedOut = 15; //reduce speed
var canvasW = canvas.width();
var canvasH = canvas.height();
var expandMax = Math.round(Math.sqrt(Math.pow(canvasW,2) + Math.pow(canvasH,2)));//diagonal calculate
var radius = 0; //initialize needed variables
var ready = 0;
var action = 0;
var canterX = 0;
var centerY = 0;
var img = new Image(); //image element initialize

img.src = "/assets/img/hidden.png"; /*using '/assets/' and not 'assets/' because on non HTTP-server is not needed to appear*/
$(img).load(function(){ //wait the 2nd img loaded to start the effect
    ready = 1;
});

$(document).ready(function(){
    canvas.mouseenter(function(e){ //jQ > when MOUSE ENTER the Canvas
        if(ready == 1){
            clearInterval(action);
            radius = 0;
            centerX = e.pageX - canvas.offset().left; //pick the mouse position X
            centerY = e.pageY - canvas.offset().top; //pick the mouse position Y
            action = setInterval(function(){ //create the timer expand
                context.clearRect(0, 0, canvasW, canvasH);
                if(radius < expandMax){
                    radius += speedIn; //expanding
                    context.save();
                    context.beginPath();
                    context.arc(centerX, centerY, radius, 0, Math.PI * 2, true); //create the circle
                    context.closePath();
                    context.clip();
                    context.drawImage(img, 0, 0);
                    context.restore();
                }else{
                    context.save();
                    context.beginPath();
                    context.arc(centerX, centerY, radius, 0, Math.PI * 2, true);//create the circle
                    context.closePath();
                    context.clip();
                    context.drawImage(img, 0, 0);
                    context.restore();
                    clearInterval(action); //kill the timer expand
                }
            }, 10);
        }
    }).mouseleave(function(e){//jQ > when MOUSE LEAVE the canvas
        clearInterval(action); //kill the timer expand
        if(radius >= expandMax){
          centerX = e.pageX - canvas.offset().left;//pick the mouse position X
          centerY = e.pageY - canvas.offset().top; //pick the mouse position Y
        }
        action = setInterval(function(){
            context.clearRect(0, 0, canvasW, canvasH); //create the timer reduce
            if(radius > 0){
                radius -= speedOut;
                context.save();
                context.beginPath();
                context.arc(centerX, centerY, radius, 0, Math.PI * 2, true); //create the circle
                context.closePath();
                context.clip();
                context.drawImage(img, 0, 0);
                context.restore();
            } else {
             clearInterval(action); //kill the timer reduce
             radius = 0;
            }
        }, 10);
    });
});